version: 2

models:
  - name: stg_sql_server_dbo__addresses.sql
    columns:
      - name: ADDRESS_ID
        tests:
          - unique
          - not_null
      - name: ZIPCODE
        tests:
          - not_null
      - name: COUNTRY
        tests:
          - not_null
      - name: ADDRESS
      - name: STATE
        tests:
          - not_null
      - name: _FIVETRAN_DELETED
      - name: _fivetran_synced
  
  - name: stg_sql_server_dbo__events
    columns:
      - name: EVENT_ID
        tests:
          - unique
          - not_null
      - name: PAGE_URL
      - name: EVENT_TYPE
        tests:
          - accepted_values:
              values:
                ["checkout", "package_shipped", "add_to_cart", "page_view"]
      - name: USER_ID
        tests:
          - not_null
          - relationships:
              to: ref('stg_sql_server_dbo__users')
              field: USER_ID
      - name: PRODUCT_ID
        tests:
          - not_null
      - name: SESSION_ID
      - name: CREATED_AT
        tests:
          - not_null
      - name: ORDER_ID
      - name: _FIVETRAN_DELETED
      - name: _fivetran_synced

  - name: stg_sql_server_dbo__order_items
    columns:
      - name: ORDER_ID
        tests:
          - not_null
          - relationships:
              to: ref('stg_sql_server_dbo__orders')
              field: ORDER_ID
      - name: PRODUCT_ID
        tests:
          - not_null
          - relationships:
              to: ref('stg_sql_server_dbo__products')
              field: PRODUCT_ID
      - name: QUANTITY
        tests:
          - not_null
      - name: _FIVETRAN_DELETED
      - name: _fivetran_synced
  
  - name: stg_sql_server_dbo__orders
    columns:
      - name: ORDER_ID
        tests:
          - unique
          - not_null
      - name: SHIPPING_SERVICE
      - name: SHIPPING_COST
      - name: ADDRESS_ID
        tests:
          - not_null
          - relationships:
              to: ref('stg_sql_server_dbo__addresses')
              field: ADDRESS_ID
      - name: CREATED_AT
      - name: PROMO_ID
      - name: ESTIMATED_DELIVERY_AT
      - name: ORDER_COST
      - name: USER_ID
        tests:
          - not_null
          - relationships:
              to: ref('stg_sql_server_dbo__users')
              field: USER_ID
      - name: ORDER_TOTAL
      - name: DELIVERED_AT
      - name: TRACKING_ID
      - name: STATUS
      - name: _FIVETRAN_DELETED
      - name: _fivetran_synced
  
  - name: stg_sql_server_dbo__products
    columns:
      - name: PRODUCT_ID
        tests:
          - unique
          - not_null
      - name: PRICE_USD
        tests:
          - not_null
      - name: NAME
        tests:
          - not_null
      - name: INVENTORY
      - name: _FIVETRAN_DELETED
      - name: _fivetran_synced

  - name: stg_sql_server_dbo__promos
    columns:
      - name: PROMO_ID
        tests:
          - unique
          - not_null
      - name: DISCOUNT
      - name: status
        tests:
          - accepted_values:
              values: ["inactive", "active"]
      - name: _FIVETRAN_DELETED
      - name: _fivetran_synced
  
  - name: stg_sql_server_dbo__users
    columns:
      - name: USER_ID
        tests:
          - unique
          - not_null
      - name: UPDATED_AT
      - name: ADDRESS_ID
        tests:
          - not_null
          - relationships:
              to: ref('stg_sql_server_dbo__addresses')
              field: ADDRESS_ID
      - name: LAST_NAME
        tests:
          - not_null
      - name: CREATED_AT
      - name: PHONE_NUMBER
      - name: TOTAL_ORDERS
      - name: FIRST_NAME
        tests:
          - not_null
      - name: EMAIL
        tests:
          - not_null
      - name: _FIVETRAN_DELETED
      - name: _fivetran_synced